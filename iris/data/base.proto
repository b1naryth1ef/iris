
enum PacketType {
  Invalid = 0;
  BeginHandshake = 1;
  DenyHandshake = 2;
  AcceptHandshake = 3;
  CompleteHandshake = 4;
  Ping = 5;
  Pong = 6;
  Close = 7;
}

message Packet {
  required PacketType type = 1;
  required bytes data = 2;
}

message PacketBeginHandshake {
  required string id = 1;
  required bytes pubkey = 2;
  required uint32 timestamp = 3;
  required uint32 challenge = 4;
}

message PacketDenyHandshake {
  required string reason = 1;
  required uint32 backoff = 2;
}

message PacketAcceptHandshake {
  required string id = 1;
  required bytes pubkey = 2;
  required bytes response = 3;
  required uint32 challenge = 4;
}

message PacketCompleteHandshake {
  required bytes response = 1; 
}

message PacketPing {
  required uint32 timestamp = 1;
  required uint32 challenge = 2;
}

message PacketPong {
  required uint32 timestamp = 1;
  required bytes response = 2;
}

message PacketClose {
  optional string reason = 1;
}


